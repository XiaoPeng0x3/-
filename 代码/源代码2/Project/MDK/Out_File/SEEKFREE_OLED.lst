C251 COMPILER V5.60.0,  SEEKFREE_OLED                                                      14/06/24  16:35:49  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE SEEKFREE_OLED
OBJECT MODULE PLACED IN .\Out_File\SEEKFREE_OLED.obj
COMPILER INVOKED BY: D:\Keil_v5\C251\BIN\C251.EXE ..\..\Libraries\seekfree_peripheral\SEEKFREE_OLED.c XSMALL INTR2 WARNI
                    -NGLEVEL(0) BROWSE INCDIR(..\..\Libraries\libraries;..\..\Libraries\seekfree_libraries;..\..\Libraries\seekfree_periphera
                    -l;..\CODE;..\USER\inc;..\USER\src) DEBUG PRINT(.\Out_File\SEEKFREE_OLED.lst) TABS(2) OBJECT(.\Out_File\SEEKFREE_OLED.obj
                    -) 

stmt  level    source

    1          /********************************************************************************************************
             -*************
    2           * COPYRIGHT NOTICE
    3           * Copyright (c) 2018,é€é£ç§‘æŠ€
    4           * All rights reserved.
    5           * æŠ€æœ¯è®¨è®ºQQç¾¤ï¼šä¸€ç¾¤ï¼š179029047(å·²æ»¡)  äºŒç¾¤ï¼š244861897
    6           *
    7           * ä»¥ä¸‹æ‰€æœ‰å†…å®¹ç‰ˆæƒå‡å±é€é£ç§‘æŠ€æ‰€æœ‰ï¼Œæœªç»å…è®¸ä¸å¾—ç”¨äºå•†ä¸šç”¨é€”ï¼Œ
    8           * æ¬¢è¿å„ä½ä½¿ç”¨å¹¶ä¼ æ’­æœ¬ç¨‹åºï¼Œä¿®æ”¹å†…å®¹æ—¶å¿…é¡»ä¿ç•™é€é£ç§‘æŠ€çš„ç‰ˆæƒå£°æ˜ã€‚
    9           *
   10           * @file          OLED
   11           * @company       æˆéƒ½é€é£ç§‘æŠ€æœ‰é™å…¬å¸
   12           * @author        é€é£ç§‘æŠ€(QQ3184284598)
   13           * @version       æŸ¥çœ‹docå†…versionæ–‡ä»¶ ç‰ˆæœ¬è¯´æ˜
   14           * @Software    MDK FOR C251 V5.60
   15           * @Taobao      https://seekfree.taobao.com/
   16           * @date          2019-04-30
   17           * @note
   18                    æ¥çº¿å®šä¹‰ï¼š
   19                    ------------------------------------
   20                      OLEDæ¶²æ™¶    å•ç‰‡æœº
   21                      D0          æŸ¥çœ‹SEEKFREE_OLEDæ–‡ä»¶å†…çš„OLED_SCL_PIN   å®å®šä¹‰
   22                      D1          æŸ¥çœ‹SEEKFREE_OLEDæ–‡ä»¶å†…çš„OLED_SDA_PIN   å®å®šä¹‰
   23                      RES         æŸ¥çœ‹SEEKFREE_OLEDæ–‡ä»¶å†…çš„OLED_RST_PIN   å®å®šä¹‰
   24                      DC          æŸ¥çœ‹SEEKFREE_OLEDæ–‡ä»¶å†…çš„OLED_DC_PIN    å®å®šä¹‰
   25                      CS          æŸ¥çœ‹SEEKFREE_OLEDæ–‡ä»¶å†…çš„OLED_CS_PIN    å®å®šä¹‰
   26                    ------------------------------------
   27           ********************************************************************************************************
             -************/
   28          
   29          #include "zf_spi.h"
   30          #include "zf_delay.h"
   31          #include "SEEKFREE_FONT.h"
   32          #include "SEEKFREE_PRINTF.h"
   33          #include "SEEKFREE_OLED.h"
   34          
   35          //-------------------------------------------------------------------------------------------------------
             -------------
   36          //  ä»¥ä¸‹å‡½æ•°æ˜¯ä½¿ç”¨è½¯ä»¶SPIé€šä¿¡ï¼Œç›¸æ¯”è¾ƒç¡¬ä»¶SPIï¼Œè½¯ä»¶SPIå¼•è„šæ›´åŠ çµæ´»ï¼Œå¯ä»¥ä½¿ç”
             -¨ä»»æ„æ™®é€šIO
   37          //-------------------------------------------------------------------------------------------------------
             -------------
   38          
   39          //-------------------------------------------------------------------------------------------------------
             -------------
   40          //  @brief      å†…éƒ¨è°ƒç”¨ï¼Œç”¨æˆ·æ— éœ€å…³å¿ƒ
   41          //  @param      void
   42          //  @return
   43          //  @since      v1.0
   44          //  Sample usage:
   45          //-------------------------------------------------------------------------------------------------------
             -------------
   46          void oled_wrdat(uint8 dat)
   47          {
   48   1        uint8 i = 8;
   49   1      
C251 COMPILER V5.60.0,  SEEKFREE_OLED                                                      14/06/24  16:35:49  PAGE 2   

   50   1        OLED_CS(0); //ä½¿èƒ½ä¿¡å·ç«¯ï¼Œæ‹‰ä½æ—¶æ­£å¸¸ä½¿ç”¨
   51   1        OLED_DC(1);
   52   1        OLED_SCL(0);
   53   1        while (i--)
   54   1        {
   55   2          if (dat & 0x80)
   56   2          {
   57   3            OLED_SDA(1);
   58   3          }
   59   2          else
   60   2          {
   61   3            OLED_SDA(0);
   62   3          }
   63   2          OLED_SCL(1);
   64   2      
   65   2          OLED_SCL(0);
   66   2          dat <<= 1;
   67   2        }
   68   1        OLED_CS(1); //ä½¿èƒ½ä¿¡å·ç«¯ï¼Œæ‹‰ä½æ—¶æ­£å¸¸ä½¿ç”¨
   69   1      }
   70          
   71          //-------------------------------------------------------------------------------------------------------
             -------------
   72          //  @brief      å†…éƒ¨è°ƒç”¨ï¼Œç”¨æˆ·æ— éœ€å…³å¿ƒ
   73          //  @param      void
   74          //  @return
   75          //  @since      v1.0
   76          //  Sample usage:
   77          //-------------------------------------------------------------------------------------------------------
             -------------
   78          // void oled_wr6dat(uint8 dat)
   79          //{
   80          //  uint8 i=6;
   81          //
   82          //  OLED_CS(0); //ä½¿èƒ½ä¿¡å·ç«¯ï¼Œæ‹‰ä½æ—¶æ­£å¸¸ä½¿ç”¨
   83          //  OLED_DC(1);
   84          //  OLED_SCL(0);
   85          //  while(i--)
   86          //  {
   87          //    if(dat&0x80){OLED_SDA(1);}
   88          //    else{OLED_SDA(0);}
   89          //    OLED_SCL(1);
   90          //    OLED_SCL(0);
   91          //    dat<<=1;
   92          //  }
   93          //    OLED_CS(1); //ä½¿èƒ½ä¿¡å·ç«¯ï¼Œæ‹‰ä½æ—¶æ­£å¸¸ä½¿ç”¨
   94          //}
   95          
   96          //-------------------------------------------------------------------------------------------------------
             -------------
   97          //  @brief      å†…éƒ¨è°ƒç”¨ï¼Œç”¨æˆ·æ— éœ€å…³å¿ƒ
   98          //  @param      void
   99          //  @return
  100          //  @since      v1.0
  101          //  Sample usage:
  102          //-------------------------------------------------------------------------------------------------------
             -------------
  103          void oled_wrcmd(uint8 cmd)
  104          {
  105   1        uint8 i = 8;
  106   1      
  107   1        OLED_CS(0); //ä½¿èƒ½ä¿¡å·ç«¯ï¼Œæ‹‰ä½æ—¶æ­£å¸¸ä½¿ç”¨
  108   1        OLED_DC(0);
  109   1        OLED_SCL(0);
  110   1        ;
  111   1      
C251 COMPILER V5.60.0,  SEEKFREE_OLED                                                      14/06/24  16:35:49  PAGE 3   

  112   1        while (i--)
  113   1        {
  114   2          if (cmd & 0x80)
  115   2          {
  116   3            OLED_SDA(1);
  117   3          }
  118   2          else
  119   2          {
  120   3            OLED_SDA(0);
  121   3          }
  122   2          OLED_SCL(1);
  123   2      
  124   2          OLED_SCL(0);
  125   2          cmd <<= 1;
  126   2        }
  127   1        OLED_CS(1); //ä½¿èƒ½ä¿¡å·ç«¯ï¼Œæ‹‰ä½æ—¶æ­£å¸¸ä½¿ç”¨
  128   1      }
  129          
  130          //-------------------------------------------------------------------------------------------------------
             -------------
  131          //  @brief      å†…éƒ¨è°ƒç”¨ï¼Œç”¨æˆ·æ— éœ€å…³å¿ƒ
  132          //  @param      void
  133          //  @return
  134          //  @since      v1.0
  135          //  Sample usage:
  136          //-------------------------------------------------------------------------------------------------------
             -------------
  137          void oled_hexascii(uint16 hex, int8 *Print)
  138          {
  139   1        uint8 hexcheck;
  140   1        uint8 TEMP;
  141   1        TEMP = 6;
  142   1        Print[TEMP] = '\0';
  143   1        while (TEMP)
  144   1        {
  145   2          TEMP--;
  146   2          hexcheck = hex % 10;
  147   2          hex /= 10;
  148   2          Print[TEMP] = hexcheck + 0x30;
  149   2        }
  150   1      }
  151          
  152          //-------------------------------------------------------------------------------------------------------
             -------------
  153          //  @brief      OLEDåˆå§‹åŒ–å‡½æ•°
  154          //  @param      NULL
  155          //  @return     void
  156          //  @since      v1.0
  157          //  Sample usage:
  158          //-------------------------------------------------------------------------------------------------------
             -------------
  159          void oled_init(void)
  160          {
  161   1      
  162   1        OLED_CS(1);
  163   1        OLED_SCL(1);
  164   1      
  165   1        OLED_RST(0);
  166   1        delay_ms(50);
  167   1        OLED_RST(1);
  168   1      
  169   1        oled_wrcmd(0xae);   //--turn off oled panel
  170   1        oled_wrcmd(0x00);   //---set low column address
  171   1        oled_wrcmd(0x10);   //---set high column address
  172   1        oled_wrcmd(0x40);   //--set start line address  Set Mapping RAM Display Start Line (0x00~0x3F)
  173   1        oled_wrcmd(0x81);   //--set contrast control register
C251 COMPILER V5.60.0,  SEEKFREE_OLED                                                      14/06/24  16:35:49  PAGE 4   

  174   1        oled_wrcmd(Brightness); // Set SEG Output Current Brightness
  175   1      
  176   1      #if (0 == OLED_DISPLAY_DIR)
  177   1        oled_wrcmd(0xa1); //--Set SEG/Column Mapping     0xa0å·¦å³åç½® 0xa1æ­£å¸¸
  178   1        oled_wrcmd(0xc8); // Set COM/Row Scan Direction   0xc0ä¸Šä¸‹åç½® 0xc8æ­£å¸¸
  179   1      #else
                 oled_wrcmd(0xa0);   //--Set SEG/Column Mapping     0xa0å·¦å³åç½® 0xa1æ­£å¸¸
                 oled_wrcmd(0xc0);   // Set COM/Row Scan Direction   0xc0ä¸Šä¸‹åç½® 0xc8æ­£å¸¸
               #endif
  183   1      
  184   1        oled_wrcmd(0xa6); //--set normal display
  185   1        oled_wrcmd(0xa8); //--set multiplex ratio(1 to 64)
  186   1        oled_wrcmd(0x3f); //--1/64 duty
  187   1        oled_wrcmd(0xd3); //-set display offset Shift Mapping RAM Counter (0x00~0x3F)
  188   1        oled_wrcmd(0x00); //-not offset
  189   1        oled_wrcmd(0xd5); //--set display clock divide ratio/oscillator frequency
  190   1        oled_wrcmd(0x80); //--set divide ratio, Set Clock as 100 Frames/Sec
  191   1        oled_wrcmd(0xd9); //--set pre-charge period
  192   1        oled_wrcmd(0xf1); // Set Pre-Charge as 15 Clocks & Discharge as 1 Clock
  193   1        oled_wrcmd(0xda); //--set com pins hardware configuration
  194   1        oled_wrcmd(0x12);
  195   1        oled_wrcmd(0xdb); //--set vcomh
  196   1        oled_wrcmd(0x40); // Set VCOM Deselect Level
  197   1        oled_wrcmd(0x20); //-Set Page Addressing Mode (0x00/0x01/0x02)
  198   1        oled_wrcmd(0x02); //
  199   1        oled_wrcmd(0x8d); //--set Charge Pump enable/disable
  200   1        oled_wrcmd(0x14); //--set(0x10) disable
  201   1        oled_wrcmd(0xa4); // Disable Entire Display On (0xa4/0xa5)
  202   1        oled_wrcmd(0xa6); // Disable Inverse Display On (0xa6/a7)
  203   1        oled_wrcmd(0xaf); //--turn on oled panel
  204   1        oled_fill(0x00);  //åˆå§‹æ¸…å±
  205   1        oled_set_pos(0, 0);
  206   1      }
  207          
  208          //-------------------------------------------------------------------------------------------------------
             -------------
  209          //  @brief      OLEDæ˜¾ç¤ºåæ ‡è®¾ç½®
  210          //  @param      x     xè½´åæ ‡è®¾ç½®0-127
  211          //  @param      y           yè½´åæ ‡è®¾ç½®0-7
  212          //  @return     void
  213          //  @since      v1.0
  214          //  Sample usage:
  215          //-------------------------------------------------------------------------------------------------------
             -------------
  216          void oled_set_pos(uint8 x, uint8 y)
  217          {
  218   1        oled_wrcmd((uint8)(0xb0 + y));
  219   1        oled_wrcmd((uint8)(((x & 0xf0) >> 4) | 0x10));
  220   1        oled_wrcmd((uint8)((x & 0x0f) | 0x00));
  221   1      }
  222          
  223          //-------------------------------------------------------------------------------------------------------
             -------------
  224          //  @brief      OLEDæ¸…å±å‡½æ•°
  225          //  @param      bmp_data  å¡«å……é¢œè‰²é€‰ç€(0x00 or 0xff)
  226          //  @return     void
  227          //  @since      v1.0
  228          //  Sample usage:
  229          //-------------------------------------------------------------------------------------------------------
             -------------
  230          void oled_fill(uint8 bmp_data)
  231          {
  232   1        uint8 y, x;
  233   1      
  234   1        for (y = 0; y < 8; y++)
  235   1        {
C251 COMPILER V5.60.0,  SEEKFREE_OLED                                                      14/06/24  16:35:49  PAGE 5   

  236   2          oled_wrcmd((uint8)(0xb0 + y));
  237   2          oled_wrcmd((uint8)(0x01));
  238   2          oled_wrcmd((uint8)(0x10));
  239   2          for (x = 0; x < X_WIDTH; x++)
  240   2            oled_wrdat(bmp_data);
  241   2        }
  242   1      }
  243          
  244          //-------------------------------------------------------------------------------------------------------
             -------------
  245          //  @brief      OLEDæ§åˆ¶ä¸€ä¸ªåæ ‡ä¸‹8ä¸ªåƒç´ çš„ç‚¹äº®ä¸ç†„ç­
  246          //  @param      x     xè½´åæ ‡è®¾ç½®0-127
  247          //  @param      y           yè½´åæ ‡è®¾ç½®0-7
  248          //  @return     void
  249          //  @since      v1.0
  250          //  Sample usage:     oled_putpixel(0,0,0xff);//å°†0,0åæ ‡ 8ä¸ªç‚¹å…¨éƒ¨ç‚¹äº®
  251          //  Sample usage:     oled_putpixel(0,0,0x01);//å°†0,0åæ ‡ æœ€ä½ä½ç‚¹äº®å…¶ä½™7ä¸ªç†„ç­
  252          //  @note                   åŒç†å¯ä»¥ä»»æ„æ§åˆ¶ä¸€ä¸ªåæ ‡ä¸‹8ä¸ªåƒç´ çš„ç‚¹äº®ä¸ç†„ç­
  253          //-------------------------------------------------------------------------------------------------------
             -------------
  254          void oled_putpixel(uint8 x, uint8 y, uint8 data1)
  255          {
  256   1        oled_set_pos(x, y);
  257   1        oled_wrcmd((uint8)(0xb0 + y));
  258   1        oled_wrcmd((uint8)(((x & 0xf0) >> 4) | 0x10));
  259   1        oled_wrcmd((uint8)((x & 0x0f) | 0x00));
  260   1        oled_wrdat(data1);
  261   1      }
  262          
  263          //-------------------------------------------------------------------------------------------------------
             -------------
  264          //  @brief      OLEDå…³é—­ä¸€ä¸ªåæ ‡æ‰€æœ‰äº®ç‚¹
  265          //  @param      x     xè½´åæ ‡è®¾ç½®0-127
  266          //  @param      y           yè½´åæ ‡è®¾ç½®0-7
  267          //  @return     void
  268          //  @since      v1.0
  269          //  Sample usage:
  270          //-------------------------------------------------------------------------------------------------------
             -------------
  271          void oled_clrpixel(uint8 x, uint8 y)
  272          {
  273   1        oled_set_pos(x, y);
  274   1        oled_wrcmd((uint8)(0xb0 + y));
  275   1        oled_wrcmd((uint8)(((x & 0xf0) >> 4) | 0x10));
  276   1        oled_wrcmd((uint8)((x & 0x0f) | 0x00));
  277   1        oled_wrdat(0x00);
  278   1      }
  279          
  280          //-------------------------------------------------------------------------------------------------------
             -------------
  281          //  @brief      OLEDæ˜¾ç¤ºå­—ç¬¦ä¸²(6*8å­—ä½“)
  282          //  @param      x     xè½´åæ ‡è®¾ç½®0-127
  283          //  @param      y           yè½´åæ ‡è®¾ç½®0-7
  284          //  @param      ch[]        å­—ç¬¦ä¸²
  285          //  @return     void
  286          //  @since      v1.0
  287          //  Sample usage:
  288          //-------------------------------------------------------------------------------------------------------
             -------------
  289          void oled_p6x8str(uint8 x, uint8 y, const int8 ch[])
  290          {
  291   1        uint8 c = 0, i = 0, j = 0;
  292   1        while (ch[j] != '\0')
  293   1        {
  294   2          c = ch[j] - 32;
  295   2          if (x > 126)
C251 COMPILER V5.60.0,  SEEKFREE_OLED                                                      14/06/24  16:35:49  PAGE 6   

  296   2          {
  297   3            x = 0;
  298   3            y++;
  299   3          }
  300   2          oled_set_pos(x, y);
  301   2          for (i = 0; i < 6; i++)
  302   2            oled_wrdat(oled_6x8[c][i]);
  303   2          x += 6;
  304   2          j++;
  305   2        }
  306   1      }
  307          
  308          //-------------------------------------------------------------------------------------------------------
             -------------
  309          //  @brief      OLEDæ˜¾ç¤ºå­—ç¬¦ä¸²(8*16å­—ä½“)
  310          //  @param      x     xè½´åæ ‡è®¾ç½®0-127
  311          //  @param      y           yè½´åæ ‡è®¾ç½®0-7
  312          //  @param      ch[]        å­—ç¬¦ä¸²
  313          //  @return     void
  314          //  @since      v1.0
  315          //  Sample usage:     åŠ¡å¿…æ³¨æ„ï¼Œæœ¬å‡½æ•°å­—ç¬¦åˆ—é«˜ä½16ï¼Œå› æ­¤yåº”è¯¥æ˜¯æ¯æ¬¡é€’å¢2
  316          //-------------------------------------------------------------------------------------------------------
             -------------
  317          void oled_p8x16str(uint8 x, uint8 y, const int8 ch[])
  318          {
  319   1        uint8 c = 0, i = 0, j = 0;
  320   1      
  321   1        while (ch[j] != '\0')
  322   1        {
  323   2          c = ch[j] - 32;
  324   2          if (x > 120)
  325   2          {
  326   3            x = 0;
  327   3            y++;
  328   3          }
  329   2      
  330   2          oled_set_pos((uint8)x, (uint8)y);
  331   2          for (i = 0; i < 8; i++)
  332   2            oled_wrdat(oled_8x16[c * 16 + i]);
  333   2      
  334   2          oled_set_pos((uint8)x, (uint8)(y + 1));
  335   2          for (i = 0; i < 8; i++)
  336   2            oled_wrdat(oled_8x16[c * 16 + i + 8]);
  337   2      
  338   2          x += 8;
  339   2          j++;
  340   2        }
  341   1      }
  342          
  343          //-------------------------------------------------------------------------------------------------------
             -------------
  344          //  @brief      OLEDæ˜¾ç¤ºæ— ç¬¦å·æ•°(6*8å­—ä½“)
  345          //  @param      x     xè½´åæ ‡è®¾ç½®0-127
  346          //  @param      y           yè½´åæ ‡è®¾ç½®0-7
  347          //  @param      num         æ— ç¬¦å·æ•°
  348          //  @return     void
  349          //  @since      v1.0
  350          //  Sample usage:
  351          //-------------------------------------------------------------------------------------------------------
             -------------
  352          void oled_uint16(uint8 x, uint8 y, uint16 num)
  353          {
  354   1        int8 ch[7];
  355   1      
  356   1        oled_hexascii(num, ch);
  357   1      
C251 COMPILER V5.60.0,  SEEKFREE_OLED                                                      14/06/24  16:35:49  PAGE 7   

  358   1        oled_p6x8str(x, y, &ch[1]); //æ˜¾ç¤ºæ•°å­—  6*8å­—ä½“
  359   1        // oled_p8x16str(x, y, &ch[1]); //æ˜¾ç¤ºæ•°å­—  8*16å­—ä½“
  360   1      }
  361          
  362          //-------------------------------------------------------------------------------------------------------
             -------------
  363          //  @brief      OLEDæ˜¾ç¤ºæœ‰ç¬¦å·æ•°(6*8å­—ä½“)
  364          //  @param      x     xè½´åæ ‡è®¾ç½®0-127
  365          //  @param      y           yè½´åæ ‡è®¾ç½®0-7
  366          //  @param      num         æœ‰ç¬¦å·æ•°
  367          //  @return     void
  368          //  @since      v1.0
  369          //  Sample usage:
  370          //-------------------------------------------------------------------------------------------------------
             -------------
  371          void oled_int16(uint8 x, uint8 y, int16 num)
  372          {
  373   1        int8 ch[7];
  374   1        if (num < 0)
  375   1        {
  376   2          num = -num;
  377   2          oled_p6x8str(x, y, "-");
  378   2        }
  379   1        else
  380   1          oled_p6x8str(x, y, " ");
  381   1        x += 6;
  382   1      
  383   1        oled_hexascii(num, ch);
  384   1        oled_p6x8str(x, y, &ch[1]); //æ˜¾ç¤ºæ•°å­—  6*8å­—ä½“
  385   1      }
  386          
  387          //-------------------------------------------------------------------------------------------------------
             -------------
  388          //  @brief      OLEDæ˜¾ç¤º32ä½æœ‰ç¬¦å·(å»é™¤æ•´æ•°éƒ¨åˆ†æ— æ•ˆçš„0)
  389          //  @param      x     xè½´åæ ‡è®¾ç½®0-127
  390          //  @param      y           yè½´åæ ‡è®¾ç½®0-7
  391          //  @param      dat         éœ€è¦æ˜¾ç¤ºçš„å˜é‡ï¼Œæ•°æ®ç±»å‹uint32
  392          //  @param      num         éœ€è¦æ˜¾ç¤ºçš„ä½æ•° æœ€é«˜10ä½  ä¸åŒ…å«æ­£è´Ÿå·
  393          //  @return     void
  394          //  @since      v1.0
  395          //  Sample usage:           oled_printf_int32(0,0,x,5);//xå¯ä»¥ä¸ºint32 uint16 int16 uint8 int8ç±»å‹
  396          //  Sample usage:           è´Ÿæ•°ä¼šæ˜¾ç¤ºä¸€ä¸ª â€˜-â€™å·   æ­£æ•°æ˜¾ç¤ºä¸€ä¸ªç©ºæ ¼
  397          //-------------------------------------------------------------------------------------------------------
             -------------
  398          void oled_printf_int32(uint16 x, uint16 y, int32 dat, uint8 num)
  399          {
  400   1        int8 buff[34];
  401   1        uint8 length;
  402   1      
  403   1        if (10 < num)
  404   1          num = 10;
  405   1      
  406   1        num++;
  407   1        if (0 > dat)
  408   1          length = zf_sprintf(&buff[0], "%d", dat); //è´Ÿæ•°
  409   1        else
  410   1        {
  411   2          buff[0] = ' ';
  412   2          length = zf_sprintf(&buff[1], "%d", dat);
  413   2          length++;
  414   2        }
  415   1        while (length < num)
  416   1        {
  417   2          buff[length] = ' ';
  418   2          length++;
  419   2        }
C251 COMPILER V5.60.0,  SEEKFREE_OLED                                                      14/06/24  16:35:49  PAGE 8   

  420   1        buff[num] = '\0';
  421   1      
  422   1        oled_p6x8str((uint8)x, (uint8)y, (int *)buff); //æ˜¾ç¤ºæ•°å­—
  423   1      }
  424          
  425          //-------------------------------------------------------------------------------------------------------
             -------------
  426          //  @brief      OLEDæ˜¾ç¤ºæµ®ç‚¹æ•°(å»é™¤æ•´æ•°éƒ¨åˆ†æ— æ•ˆçš„0)
  427          //  @param      x     xè½´åæ ‡è®¾ç½®0-127
  428          //  @param      y           yè½´åæ ‡è®¾ç½®0-7
  429          //  @param      dat         éœ€è¦æ˜¾ç¤ºçš„å˜é‡ï¼Œæ•°æ®ç±»å‹floatæˆ–double
  430          //  @param      num         æ•´æ•°ä½æ˜¾ç¤ºé•¿åº¦   æœ€é«˜10ä½
  431          //  @param      pointnum    å°æ•°ä½æ˜¾ç¤ºé•¿åº¦   æœ€é«˜6ä½
  432          //  @return     void
  433          //  @since      v1.0
  434          //  Sample usage:           oled_printf_float(0,0,x,2,3);//æ˜¾ç¤ºæµ®ç‚¹æ•°   æ•´æ•°æ˜¾ç¤º2ä½   å°æ•°æ˜¾
             -ç¤ºä¸‰ä½
  435          //  @note                   ç‰¹åˆ«æ³¨æ„å½“å‘ç°å°æ•°éƒ¨åˆ†æ˜¾ç¤ºçš„å€¼ä¸ä½ å†™å…¥çš„å€¼ä¸ä¸€æ ·çš„æ—
             -¶å€™ï¼Œ
  436          //                          å¯èƒ½æ˜¯ç”±äºæµ®ç‚¹æ•°ç²¾åº¦ä¸¢å¤±é—®é¢˜å¯¼è‡´çš„ï¼Œè¿™å¹¶ä¸æ˜¯æ˜¾ç¤ºå‡½æ•
             -°çš„é—®é¢˜ï¼Œ
  437          //                          æœ‰å…³é—®é¢˜çš„è¯¦æƒ…ï¼Œè¯·è‡ªè¡Œç™¾åº¦å­¦ä¹    æµ®ç‚¹æ•°ç²¾åº¦ä¸¢å¤±é—®é¢˜ã€
             -‚
  438          //                          è´Ÿæ•°ä¼šæ˜¾ç¤ºä¸€ä¸ª â€˜-â€™å·   æ­£æ•°æ˜¾ç¤ºä¸€ä¸ªç©ºæ ¼
  439          //-------------------------------------------------------------------------------------------------------
             -------------
  440          void oled_printf_float(uint16 x, uint16 y, double dat, uint8 num, uint8 pointnum)
  441          {
  442   1        uint8 length;
  443   1        int8 buff[34];
  444   1        int8 start, end, point;
  445   1      
  446   1        if (6 < pointnum)
  447   1          pointnum = 6;
  448   1        if (10 < num)
  449   1          num = 10;
  450   1      
  451   1        if (0 > dat)
  452   1          length = zf_sprintf(&buff[0], "%f", dat); //è´Ÿæ•°
  453   1        else
  454   1        {
  455   2          length = zf_sprintf(&buff[1], "%f", dat);
  456   2          length++;
  457   2        }
  458   1        point = length - 7;     //è®¡ç®—å°æ•°ç‚¹ä½ç½®
  459   1        start = point - num - 1;  //è®¡ç®—èµ·å§‹ä½
  460   1        end = point + pointnum + 1; //è®¡ç®—ç»“æŸä½
  461   1        while (0 > start)     //æ•´æ•°ä½ä¸å¤Ÿ  æœ«å°¾åº”è¯¥å¡«å……ç©ºæ ¼
  462   1        {
  463   2          buff[end] = ' ';
  464   2          end++;
  465   2          start++;
  466   2        }
  467   1      
  468   1        if (0 > dat)
  469   1          buff[start] = '-';
  470   1        else
  471   1          buff[start] = ' ';
  472   1      
  473   1        buff[end] = '\0';
  474   1      
  475   1        oled_p6x8str((uint8)x, (uint8)y, (int8 *)buff); //æ˜¾ç¤ºæ•°å­—
  476   1      }
  477          
  478          //-------------------------------------------------------------------------------------------------------
             -------------
C251 COMPILER V5.60.0,  SEEKFREE_OLED                                                      14/06/24  16:35:49  PAGE 9   

  479          //  @brief      OLEDæ˜¾ç¤ºå›¾åƒ
  480          //  @param      high      å›¾åƒé«˜åº¦
  481          //  @param      width     å›¾åƒå®½åº¦
  482          //  @param      *p        å›¾åƒåœ°å€ï¼ˆæ•°ç»„ï¼‰
  483          //  @param      value     äºŒå€¼åŒ–é˜€å€¼
  484          //  @return     void
  485          //  @since      v1.0
  486          //  Sample usage:
  487          //  @Note       ä½¿ç”¨Image2lcd V3.2è½¯ä»¶å–æ¨¡   Cè¯­è¨€æ•°ç»„   æ°´å¹³æ‰«æ
  488          //              å®½åº¦é«˜åº¦è‡ªè¡Œè®¾ç½®   é¢œè‰²åè½¬  256è‰²
  489          //-------------------------------------------------------------------------------------------------------
             -------------
  490          void oled_dis_bmp(uint16 high, uint16 width, uint8 *p, uint8 value)
  491          {
  492   1        uint16 i = 0;
  493   1        uint16 j = 0;
  494   1        uint16 temp = 0, temp1 = 0;
  495   1        uint8 dat = 0;
  496   1      
  497   1        temp1 = high % 8;
  498   1        if (temp1 == 0)
  499   1          temp = high / 8;
  500   1        else
  501   1          temp = high / 8 + 1;
  502   1      
  503   1        for (i = 0; i < temp; i++)
  504   1        {
  505   2          oled_set_pos((uint8)0, (uint8)i);
  506   2      
  507   2          for (j = 0; j < width; j++)
  508   2          {
  509   3            dat = 0;
  510   3            if ((i < (temp - 1)) || !temp1 || (temp1 >= 1))
  511   3              dat |= (*(p + i * 8 * width + j + width * 0) > value ? 1 : 0) << 0;
  512   3            if ((i < (temp - 1)) || !temp1 || (temp1 >= 2))
  513   3              dat |= (*(p + i * 8 * width + j + width * 1) > value ? 1 : 0) << 1;
  514   3            if ((i < (temp - 1)) || !temp1 || (temp1 >= 3))
  515   3              dat |= (*(p + i * 8 * width + j + width * 2) > value ? 1 : 0) << 2;
  516   3            if ((i < (temp - 1)) || !temp1 || (temp1 >= 4))
  517   3              dat |= (*(p + i * 8 * width + j + width * 3) > value ? 1 : 0) << 3;
  518   3            if ((i < (temp - 1)) || !temp1 || (temp1 >= 5))
  519   3              dat |= (*(p + i * 8 * width + j + width * 4) > value ? 1 : 0) << 4;
  520   3            if ((i < (temp - 1)) || !temp1 || (temp1 >= 6))
  521   3              dat |= (*(p + i * 8 * width + j + width * 5) > value ? 1 : 0) << 5;
  522   3            if ((i < (temp - 1)) || !temp1 || (temp1 >= 7))
  523   3              dat |= (*(p + i * 8 * width + j + width * 6) > value ? 1 : 0) << 6;
  524   3            if ((i < (temp - 1)) || !temp1 || (temp1 >= 8))
  525   3              dat |= (*(p + i * 8 * width + j + width * 7) > value ? 1 : 0) << 7;
  526   3      
  527   3            oled_wrdat(dat);
  528   3          }
  529   2        }
  530   1      }
  531          
  532          //-------------------------------------------------------------------------------------------------------
             -------------
  533          //  @brief      æ±‰å­—æ˜¾ç¤º
  534          //  @param      x       æ¨ªåæ ‡ 0-127
  535          //  @param      y       çºµåæ ‡ 0-7
  536          //  @param      size    å–æ¨¡çš„æ—¶å€™è®¾ç½®çš„æ±‰å­—å­—ä½“å¤§å°ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ±‰å­—å ç”¨çš„ç‚¹é˜µ
             -é•¿å®½ä¸ºå¤šå°‘ä¸ªç‚¹ï¼Œå–æ¨¡çš„æ—¶å€™éœ€è¦é•¿å®½æ˜¯ä¸€æ ·çš„ã€‚
  537          //  @param      *p      éœ€è¦æ˜¾ç¤ºçš„æ±‰å­—æ•°ç»„
  538          //  @param      len     éœ€è¦æ˜¾ç¤ºå¤šå°‘ä½
  539          //  @return     void
  540          //  @since      v1.0
  541          //  Sample usage:
C251 COMPILER V5.60.0,  SEEKFREE_OLED                                                      14/06/24  16:35:49  PAGE 10  

  542          //  @Note       ä½¿ç”¨PCtoLCD2002è½¯ä»¶å–æ¨¡       é˜´ç ã€é€è¡Œå¼ã€é¡ºå‘   16*16
  543          //-------------------------------------------------------------------------------------------------------
             -------------
  544          void oled_print_chinese(uint8 x, uint8 y, uint8 size, const uint8 *p, uint8 len)
  545          {
  546   1        uint16 i, j, k;
  547   1      
  548   1        for (i = 0; i < len; i++)
  549   1        {
  550   2          for (j = 0; j < (size / 8); j++)
  551   2          {
  552   3            oled_set_pos((uint8)(x + i * size), (uint8)(y + j));
  553   3            for (k = 0; k < 16; k++)
  554   3            {
  555   4              oled_wrdat(*p);
  556   4              p++;
  557   4            }
  558   3          }
  559   2        }
  560   1      }
  561          
  562          //-------------------------------------------------------------------------------------------------------
             -------------
  563          //  ä»¥ä¸‹å‡½æ•°æ˜¯ä½¿ç”¨ç¡¬ä»¶SPIé€šä¿¡ï¼Œç›¸æ¯”è¾ƒè½¯ä»¶IICï¼Œé€Ÿåº¦æ¯”è½¯ä»¶IICå¿«ã€‚
  564          //-------------------------------------------------------------------------------------------------------
             -------------
  565          
  566          //-------------------------------------------------------------------------------------------------------
             -------------
  567          //  @brief      å†…éƒ¨è°ƒç”¨ï¼Œç”¨æˆ·æ— éœ€å…³å¿ƒ
  568          //  @param      void
  569          //  @return
  570          //  @since      v1.0
  571          //  Sample usage:
  572          //-------------------------------------------------------------------------------------------------------
             -------------
  573          void oled_wrdat_spi(uint8 dat)
  574          {
  575   1        OLED_SPI_CS(0); //ä½¿èƒ½ä¿¡å·ç«¯ï¼Œæ‹‰ä½æ—¶æ­£å¸¸ä½¿ç”¨
  576   1        OLED_SPI_DC(1);
  577   1        spi_mosi(dat);
  578   1        OLED_SPI_CS(1); //ä½¿èƒ½ä¿¡å·ç«¯ï¼Œæ‹‰ä½æ—¶æ­£å¸¸ä½¿ç”¨
  579   1      }
  580          
  581          //-------------------------------------------------------------------------------------------------------
             -------------
  582          //  @brief      å†…éƒ¨è°ƒç”¨ï¼Œç”¨æˆ·æ— éœ€å…³å¿ƒ
  583          //  @param      void
  584          //  @return
  585          //  @since      v1.0
  586          //  Sample usage:
  587          //-------------------------------------------------------------------------------------------------------
             -------------
  588          // void oled_wr6dat_spi(uint8 dat)
  589          //{
  590          //  uint8 i=6;
  591          //
  592          //  OLED_SPI_CS(0); //ä½¿èƒ½ä¿¡å·ç«¯ï¼Œæ‹‰ä½æ—¶æ­£å¸¸ä½¿ç”¨
  593          //  OLED_SPI_DC(1);
  594          //  OLED_SCL(0);
  595          //  while(i--)
  596          //  {
  597          //    if(dat&0x80){OLED_SDA(1);}
  598          //    else{OLED_SDA(0);}
  599          //    OLED_SCL(1);
  600          //    OLED_SCL(0);
C251 COMPILER V5.60.0,  SEEKFREE_OLED                                                      14/06/24  16:35:49  PAGE 11  

  601          //    dat<<=1;
  602          //  }
  603          //    OLED_SPI_CS(1); //ä½¿èƒ½ä¿¡å·ç«¯ï¼Œæ‹‰ä½æ—¶æ­£å¸¸ä½¿ç”¨
  604          //}
  605          
  606          //-------------------------------------------------------------------------------------------------------
             -------------
  607          //  @brief      å†…éƒ¨è°ƒç”¨ï¼Œç”¨æˆ·æ— éœ€å…³å¿ƒ
  608          //  @param      void
  609          //  @return
  610          //  @since      v1.0
  611          //  Sample usage:
  612          //-------------------------------------------------------------------------------------------------------
             -------------
  613          void oled_wrcmd_spi(uint8 cmd)
  614          {
  615   1        OLED_SPI_CS(0); //ä½¿èƒ½ä¿¡å·ç«¯ï¼Œæ‹‰ä½æ—¶æ­£å¸¸ä½¿ç”¨
  616   1        OLED_SPI_DC(0);
  617   1        spi_mosi(cmd);
  618   1        OLED_SPI_CS(1); //ä½¿èƒ½ä¿¡å·ç«¯ï¼Œæ‹‰ä½æ—¶æ­£å¸¸ä½¿ç”¨
  619   1      }
  620          
  621          //-------------------------------------------------------------------------------------------------------
             -------------
  622          //  @brief      å†…éƒ¨è°ƒç”¨ï¼Œç”¨æˆ·æ— éœ€å…³å¿ƒ
  623          //  @param      void
  624          //  @return
  625          //  @since      v1.0
  626          //  Sample usage:
  627          //-------------------------------------------------------------------------------------------------------
             -------------
  628          void oled_hexascii_spi(uint16 hex, int8 *Print)
  629          {
  630   1        uint8 hexcheck;
  631   1        uint8 TEMP;
  632   1        TEMP = 6;
  633   1        Print[TEMP] = '\0';
  634   1        while (TEMP)
  635   1        {
  636   2          TEMP--;
  637   2          hexcheck = hex % 10;
  638   2          hex /= 10;
  639   2          Print[TEMP] = hexcheck + 0x30;
  640   2        }
  641   1      }
  642          
  643          //-------------------------------------------------------------------------------------------------------
             -------------
  644          //  @brief      OLEDåˆå§‹åŒ–å‡½æ•°
  645          //  @param      NULL
  646          //  @return     void
  647          //  @since      v1.0
  648          //  Sample usage:
  649          //-------------------------------------------------------------------------------------------------------
             -------------
  650          void oled_init_spi(void)
  651          {
  652   1      
  653   1        OLED_SPI_CS(1);
  654   1      
  655   1        spi_init(OLED_SPI_N, OLED_SPI_SCLK_PIN, OLED_SPI_MOSI_PIN, OLED_SPI_MISO_PIN, 0, MASTER, SPI_SYSclk_DIV_
             -4);
  656   1      
  657   1        OLED_SPI_RST(0);
  658   1        delay_ms(50);
  659   1        OLED_SPI_RST(1);
C251 COMPILER V5.60.0,  SEEKFREE_OLED                                                      14/06/24  16:35:49  PAGE 12  

  660   1      
  661   1        oled_wrcmd_spi(0xae);   //--turn off oled panel
  662   1        oled_wrcmd_spi(0x00);   //---set low column address
  663   1        oled_wrcmd_spi(0x10);   //---set high column address
  664   1        oled_wrcmd_spi(0x40);   //--set start line address  Set Mapping RAM Display Start Line (0x00~0x3F)
  665   1        oled_wrcmd_spi(0x81);   //--set contrast control register
  666   1        oled_wrcmd_spi(Brightness); // Set SEG Output Current Brightness
  667   1      
  668   1      #if (0 == OLED_DISPLAY_DIR)
  669   1        oled_wrcmd_spi(0xa1); //--Set SEG/Column Mapping     0xa0å·¦å³åç½® 0xa1æ­£å¸¸
  670   1        oled_wrcmd_spi(0xc8); // Set COM/Row Scan Direction   0xc0ä¸Šä¸‹åç½® 0xc8æ­£å¸¸
  671   1      #else
                 oled_wrcmd_spi(0xa0); //--Set SEG/Column Mapping     0xa0å·¦å³åç½® 0xa1æ­£å¸¸
                 oled_wrcmd_spi(0xc0); // Set COM/Row Scan Direction   0xc0ä¸Šä¸‹åç½® 0xc8æ­£å¸¸
               #endif
  675   1      
  676   1        oled_wrcmd_spi(0xa6); //--set normal display
  677   1        oled_wrcmd_spi(0xa8); //--set multiplex ratio(1 to 64)
  678   1        oled_wrcmd_spi(0x3f); //--1/64 duty
  679   1        oled_wrcmd_spi(0xd3); //-set display offset Shift Mapping RAM Counter (0x00~0x3F)
  680   1        oled_wrcmd_spi(0x00); //-not offset
  681   1        oled_wrcmd_spi(0xd5); //--set display clock divide ratio/oscillator frequency
  682   1        oled_wrcmd_spi(0x80); //--set divide ratio, Set Clock as 100 Frames/Sec
  683   1        oled_wrcmd_spi(0xd9); //--set pre-charge period
  684   1        oled_wrcmd_spi(0xf1); // Set Pre-Charge as 15 Clocks & Discharge as 1 Clock
  685   1        oled_wrcmd_spi(0xda); //--set com pins hardware configuration
  686   1        oled_wrcmd_spi(0x12);
  687   1        oled_wrcmd_spi(0xdb); //--set vcomh
  688   1        oled_wrcmd_spi(0x40); // Set VCOM Deselect Level
  689   1        oled_wrcmd_spi(0x20); //-Set Page Addressing Mode (0x00/0x01/0x02)
  690   1        oled_wrcmd_spi(0x02); //
  691   1        oled_wrcmd_spi(0x8d); //--set Charge Pump enable/disable
  692   1        oled_wrcmd_spi(0x14); //--set(0x10) disable
  693   1        oled_wrcmd_spi(0xa4); // Disable Entire Display On (0xa4/0xa5)
  694   1        oled_wrcmd_spi(0xa6); // Disable Inverse Display On (0xa6/a7)
  695   1        oled_wrcmd_spi(0xaf); //--turn on oled panel
  696   1        oled_fill_spi(0x00);  //åˆå§‹æ¸…å±
  697   1        oled_set_pos_spi(0, 0);
  698   1      }
  699          
  700          //-------------------------------------------------------------------------------------------------------
             -------------
  701          //  @brief      OLEDæ˜¾ç¤ºåæ ‡è®¾ç½®
  702          //  @param      x     xè½´åæ ‡è®¾ç½®0-127
  703          //  @param      y           yè½´åæ ‡è®¾ç½®0-7
  704          //  @return     void
  705          //  @since      v1.0
  706          //  Sample usage:
  707          //-------------------------------------------------------------------------------------------------------
             -------------
  708          void oled_set_pos_spi(uint8 x, uint8 y)
  709          {
  710   1      
  711   1        oled_wrcmd_spi((uint8)(0xb0 + y));
  712   1        oled_wrcmd_spi(((x & 0xf0) >> 4) | 0x10);
  713   1        oled_wrcmd_spi((x & 0x0f) | 0x00);
  714   1      }
  715          
  716          //-------------------------------------------------------------------------------------------------------
             -------------
  717          //  @brief      OLEDæ¸…å±å‡½æ•°
  718          //  @param      bmp_data  å¡«å……é¢œè‰²é€‰ç€(0x00 or 0xff)
  719          //  @return     void
  720          //  @since      v1.0
  721          //  Sample usage:
  722          //-------------------------------------------------------------------------------------------------------
C251 COMPILER V5.60.0,  SEEKFREE_OLED                                                      14/06/24  16:35:49  PAGE 13  

             -------------
  723          void oled_fill_spi(uint8 bmp_data)
  724          {
  725   1        uint8 y, x;
  726   1      
  727   1        for (y = 0; y < 8; y++)
  728   1        {
  729   2          oled_wrcmd_spi((uint8)(0xb0 + y));
  730   2          oled_wrcmd_spi(0x01);
  731   2          oled_wrcmd_spi(0x10);
  732   2          for (x = 0; x < X_WIDTH; x++)
  733   2            oled_wrdat_spi(bmp_data);
  734   2        }
  735   1      }
  736          
  737          //-------------------------------------------------------------------------------------------------------
             -------------
  738          //  @brief      OLEDæ§åˆ¶ä¸€ä¸ªåæ ‡ä¸‹8ä¸ªåƒç´ çš„ç‚¹äº®ä¸ç†„ç­
  739          //  @param      x     xè½´åæ ‡è®¾ç½®0-127
  740          //  @param      y           yè½´åæ ‡è®¾ç½®0-7
  741          //  @return     void
  742          //  @since      v1.0
  743          //  Sample usage:     oled_putpixel(0,0,0xff);//å°†0,0åæ ‡ 8ä¸ªç‚¹å…¨éƒ¨ç‚¹äº®
  744          //  Sample usage:     oled_putpixel(0,0,0x01);//å°†0,0åæ ‡ æœ€ä½ä½ç‚¹äº®å…¶ä½™7ä¸ªç†„ç­
  745          //  @note                   åŒç†å¯ä»¥ä»»æ„æ§åˆ¶ä¸€ä¸ªåæ ‡ä¸‹8ä¸ªåƒç´ çš„ç‚¹äº®ä¸ç†„ç­
  746          //-------------------------------------------------------------------------------------------------------
             -------------
  747          void oled_putpixel_spi(uint8 x, uint8 y, uint8 data1)
  748          {
  749   1        oled_set_pos_spi(x, y);
  750   1        oled_wrcmd_spi((uint8)(0xb0 + y));
  751   1        oled_wrcmd_spi(((x & 0xf0) >> 4) | 0x10);
  752   1        oled_wrcmd_spi((x & 0x0f) | 0x00);
  753   1        oled_wrdat_spi(data1);
  754   1      }
  755          
  756          //-------------------------------------------------------------------------------------------------------
             -------------
  757          //  @brief      OLEDå…³é—­ä¸€ä¸ªåæ ‡æ‰€æœ‰äº®ç‚¹
  758          //  @param      x     xè½´åæ ‡è®¾ç½®0-127
  759          //  @param      y           yè½´åæ ‡è®¾ç½®0-7
  760          //  @return     void
  761          //  @since      v1.0
  762          //  Sample usage:
  763          //-------------------------------------------------------------------------------------------------------
             -------------
  764          void oled_clrpixel_spi(uint8 x, uint8 y)
  765          {
  766   1        oled_set_pos_spi(x, y);
  767   1        oled_wrcmd_spi((uint8)(0xb0 + y));
  768   1        oled_wrcmd_spi(((x & 0xf0) >> 4) | 0x10);
  769   1        oled_wrcmd_spi((x & 0x0f) | 0x00);
  770   1        oled_wrdat_spi(0x00);
  771   1      }
  772          
  773          //-------------------------------------------------------------------------------------------------------
             -------------
  774          //  @brief      OLEDæ˜¾ç¤ºå­—ç¬¦ä¸²(6*8å­—ä½“)
  775          //  @param      x     xè½´åæ ‡è®¾ç½®0-127
  776          //  @param      y           yè½´åæ ‡è®¾ç½®0-7
  777          //  @param      ch[]        å­—ç¬¦ä¸²
  778          //  @return     void
  779          //  @since      v1.0
  780          //  Sample usage:
  781          //-------------------------------------------------------------------------------------------------------
             -------------
C251 COMPILER V5.60.0,  SEEKFREE_OLED                                                      14/06/24  16:35:49  PAGE 14  

  782          void oled_p6x8str_spi(uint8 x, uint8 y, const int8 ch[])
  783          {
  784   1        uint8 c = 0, i = 0, j = 0;
  785   1        while (ch[j] != '\0')
  786   1        {
  787   2          c = ch[j] - 32;
  788   2          if (x > 126)
  789   2          {
  790   3            x = 0;
  791   3            y++;
  792   3          }
  793   2          oled_set_pos_spi(x, y);
  794   2          for (i = 0; i < 6; i++)
  795   2            oled_wrdat_spi(oled_6x8[c][i]);
  796   2          x += 6;
  797   2          j++;
  798   2        }
  799   1      }
  800          
  801          //-------------------------------------------------------------------------------------------------------
             -------------
  802          //  @brief      OLEDæ˜¾ç¤ºå­—ç¬¦ä¸²(8*16å­—ä½“)
  803          //  @param      x     xè½´åæ ‡è®¾ç½®0-127
  804          //  @param      y           yè½´åæ ‡è®¾ç½®0-7
  805          //  @param      ch[]        å­—ç¬¦ä¸²
  806          //  @return     void
  807          //  @since      v1.0
  808          //  Sample usage:     åŠ¡å¿…æ³¨æ„ï¼Œæœ¬å‡½æ•°å­—ç¬¦åˆ—é«˜ä½16ï¼Œå› æ­¤yåº”è¯¥æ˜¯æ¯æ¬¡é€’å¢2
  809          //-------------------------------------------------------------------------------------------------------
             -------------
  810          void oled_p8x16str_spi(uint8 x, uint8 y, const int8 ch[])
  811          {
  812   1        uint8 c = 0, i = 0, j = 0;
  813   1      
  814   1        while (ch[j] != '\0')
  815   1        {
  816   2          c = ch[j] - 32;
  817   2          if (x > 120)
  818   2          {
  819   3            x = 0;
  820   3            y++;
  821   3          }
  822   2      
  823   2          oled_set_pos_spi((uint8)x, (uint8)y);
  824   2          for (i = 0; i < 8; i++)
  825   2            oled_wrdat_spi(oled_8x16[c * 16 + i]);
  826   2      
  827   2          oled_set_pos_spi((uint8)x, (uint8)(y + 1));
  828   2          for (i = 0; i < 8; i++)
  829   2            oled_wrdat_spi(oled_8x16[c * 16 + i + 8]);
  830   2      
  831   2          x += 8;
  832   2          j++;
  833   2        }
  834   1      }
  835          
  836          //-------------------------------------------------------------------------------------------------------
             -------------
  837          //  @brief      OLEDæ˜¾ç¤ºæ— ç¬¦å·æ•°(6*8å­—ä½“)
  838          //  @param      x     xè½´åæ ‡è®¾ç½®0-127
  839          //  @param      y           yè½´åæ ‡è®¾ç½®0-7
  840          //  @param      num         æ— ç¬¦å·æ•°
  841          //  @return     void
  842          //  @since      v1.0
  843          //  Sample usage:
  844          //-------------------------------------------------------------------------------------------------------
C251 COMPILER V5.60.0,  SEEKFREE_OLED                                                      14/06/24  16:35:49  PAGE 15  

             -------------
  845          void oled_uint16_spi(uint8 x, uint8 y, uint16 num)
  846          {
  847   1        int8 ch[7];
  848   1      
  849   1        oled_hexascii_spi(num, ch);
  850   1      
  851   1        oled_p6x8str_spi(x, y, &ch[1]); //æ˜¾ç¤ºæ•°å­—  6*8å­—ä½“
  852   1        // oled_p8x16str(x, y, &ch[1]); //æ˜¾ç¤ºæ•°å­—  8*16å­—ä½“
  853   1      }
  854          
  855          //-------------------------------------------------------------------------------------------------------
             -------------
  856          //  @brief      OLEDæ˜¾ç¤ºæœ‰ç¬¦å·æ•°(6*8å­—ä½“)
  857          //  @param      x     xè½´åæ ‡è®¾ç½®0-127
  858          //  @param      y           yè½´åæ ‡è®¾ç½®0-7
  859          //  @param      num         æœ‰ç¬¦å·æ•°
  860          //  @return     void
  861          //  @since      v1.0
  862          //  Sample usage:
  863          //-------------------------------------------------------------------------------------------------------
             -------------
  864          void oled_int16_spi(uint8 x, uint8 y, int16 num)
  865          {
  866   1        int8 ch[7];
  867   1        if (num < 0)
  868   1        {
  869   2          num = -num;
  870   2          oled_p6x8str_spi(x, y, "-");
  871   2        }
  872   1        else
  873   1          oled_p6x8str_spi(x, y, " ");
  874   1        x += 6;
  875   1      
  876   1        oled_hexascii_spi(num, ch);
  877   1        oled_p6x8str_spi(x, y, &ch[1]); //æ˜¾ç¤ºæ•°å­—  6*8å­—ä½“
  878   1      }
  879          
  880          //-------------------------------------------------------------------------------------------------------
             -------------
  881          //  @brief      OLEDæ˜¾ç¤º32ä½æœ‰ç¬¦å·(å»é™¤æ•´æ•°éƒ¨åˆ†æ— æ•ˆçš„0)
  882          //  @param      x     xè½´åæ ‡è®¾ç½®0-127
  883          //  @param      y           yè½´åæ ‡è®¾ç½®0-7
  884          //  @param      dat         éœ€è¦æ˜¾ç¤ºçš„å˜é‡ï¼Œæ•°æ®ç±»å‹uint32
  885          //  @param      num         éœ€è¦æ˜¾ç¤ºçš„ä½æ•° æœ€é«˜10ä½  ä¸åŒ…å«æ­£è´Ÿå·
  886          //  @return     void
  887          //  @since      v1.0
  888          //  Sample usage:           oled_printf_int32(0,0,x,5);//xå¯ä»¥ä¸ºint32 uint16 int16 uint8 int8ç±»å‹
  889          //  Sample usage:           è´Ÿæ•°ä¼šæ˜¾ç¤ºä¸€ä¸ª â€˜-â€™å·   æ­£æ•°æ˜¾ç¤ºä¸€ä¸ªç©ºæ ¼
  890          //-------------------------------------------------------------------------------------------------------
             -------------
  891          void oled_printf_int32_spi(uint16 x, uint16 y, int32 dat, uint8 num)
  892          {
  893   1        int8 buff[34];
  894   1        uint8 length;
  895   1      
  896   1        if (10 < num)
  897   1          num = 10;
  898   1      
  899   1        num++;
  900   1        if (0 > dat)
  901   1          length = zf_sprintf(&buff[0], "%d", dat); //è´Ÿæ•°
  902   1        else
  903   1        {
  904   2          buff[0] = ' ';
  905   2          length = zf_sprintf(&buff[1], "%d", dat);
C251 COMPILER V5.60.0,  SEEKFREE_OLED                                                      14/06/24  16:35:49  PAGE 16  

  906   2          length++;
  907   2        }
  908   1        while (length < num)
  909   1        {
  910   2          buff[length] = ' ';
  911   2          length++;
  912   2        }
  913   1        buff[num] = '\0';
  914   1      
  915   1        oled_p6x8str_spi((uint8)x, (uint8)y, (int *)buff); //æ˜¾ç¤ºæ•°å­—
  916   1      }
  917          
  918          //-------------------------------------------------------------------------------------------------------
             -------------
  919          //  @brief      OLEDæ˜¾ç¤ºæµ®ç‚¹æ•°(å»é™¤æ•´æ•°éƒ¨åˆ†æ— æ•ˆçš„0)
  920          //  @param      x     xè½´åæ ‡è®¾ç½®0-127
  921          //  @param      y           yè½´åæ ‡è®¾ç½®0-7
  922          //  @param      dat         éœ€è¦æ˜¾ç¤ºçš„å˜é‡ï¼Œæ•°æ®ç±»å‹floatæˆ–double
  923          //  @param      num         æ•´æ•°ä½æ˜¾ç¤ºé•¿åº¦   æœ€é«˜10ä½
  924          //  @param      pointnum    å°æ•°ä½æ˜¾ç¤ºé•¿åº¦   æœ€é«˜6ä½
  925          //  @return     void
  926          //  @since      v1.0
  927          //  Sample usage:           oled_printf_float(0,0,x,2,3);//æ˜¾ç¤ºæµ®ç‚¹æ•°   æ•´æ•°æ˜¾ç¤º2ä½   å°æ•°æ˜¾
             -ç¤ºä¸‰ä½
  928          //  @note                   ç‰¹åˆ«æ³¨æ„å½“å‘ç°å°æ•°éƒ¨åˆ†æ˜¾ç¤ºçš„å€¼ä¸ä½ å†™å…¥çš„å€¼ä¸ä¸€æ ·çš„æ—
             -¶å€™ï¼Œ
  929          //                          å¯èƒ½æ˜¯ç”±äºæµ®ç‚¹æ•°ç²¾åº¦ä¸¢å¤±é—®é¢˜å¯¼è‡´çš„ï¼Œè¿™å¹¶ä¸æ˜¯æ˜¾ç¤ºå‡½æ•
             -°çš„é—®é¢˜ï¼Œ
  930          //                          æœ‰å…³é—®é¢˜çš„è¯¦æƒ…ï¼Œè¯·è‡ªè¡Œç™¾åº¦å­¦ä¹    æµ®ç‚¹æ•°ç²¾åº¦ä¸¢å¤±é—®é¢˜ã€
             -‚
  931          //                          è´Ÿæ•°ä¼šæ˜¾ç¤ºä¸€ä¸ª â€˜-â€™å·   æ­£æ•°æ˜¾ç¤ºä¸€ä¸ªç©ºæ ¼
  932          //-------------------------------------------------------------------------------------------------------
             -------------
  933          void oled_printf_float_spi(uint16 x, uint16 y, double dat, uint8 num, uint8 pointnum)
  934          {
  935   1        uint8 length;
  936   1        int8 buff[34];
  937   1        int8 start, end, point;
  938   1      
  939   1        if (6 < pointnum)
  940   1          pointnum = 6;
  941   1        if (10 < num)
  942   1          num = 10;
  943   1      
  944   1        if (0 > dat)
  945   1          length = zf_sprintf(&buff[0], "%f", dat); //è´Ÿæ•°
  946   1        else
  947   1        {
  948   2          length = zf_sprintf(&buff[1], "%f", dat);
  949   2          length++;
  950   2        }
  951   1        point = length - 7;     //è®¡ç®—å°æ•°ç‚¹ä½ç½®
  952   1        start = point - num - 1;  //è®¡ç®—èµ·å§‹ä½
  953   1        end = point + pointnum + 1; //è®¡ç®—ç»“æŸä½
  954   1        while (0 > start)     //æ•´æ•°ä½ä¸å¤Ÿ  æœ«å°¾åº”è¯¥å¡«å……ç©ºæ ¼
  955   1        {
  956   2          buff[end] = ' ';
  957   2          end++;
  958   2          start++;
  959   2        }
  960   1      
  961   1        if (0 > dat)
  962   1          buff[start] = '-';
  963   1        else
  964   1          buff[start] = ' ';
  965   1      
C251 COMPILER V5.60.0,  SEEKFREE_OLED                                                      14/06/24  16:35:49  PAGE 17  

  966   1        buff[end] = '\0';
  967   1      
  968   1        oled_p6x8str_spi((uint8)x, (uint8)y, (int8 *)buff); //æ˜¾ç¤ºæ•°å­—
  969   1      }
  970          
  971          //-------------------------------------------------------------------------------------------------------
             -------------
  972          //  @brief      OLEDæ˜¾ç¤ºå›¾åƒ
  973          //  @param      high      å›¾åƒé«˜åº¦
  974          //  @param      width     å›¾åƒå®½åº¦
  975          //  @param      *p        å›¾åƒåœ°å€ï¼ˆæ•°ç»„ï¼‰
  976          //  @param      value     äºŒå€¼åŒ–é˜€å€¼
  977          //  @return     void
  978          //  @since      v1.0
  979          //  Sample usage:
  980          //  @Note       ä½¿ç”¨Image2lcd V3.2è½¯ä»¶å–æ¨¡   Cè¯­è¨€æ•°ç»„   æ°´å¹³æ‰«æ
  981          //              å®½åº¦é«˜åº¦è‡ªè¡Œè®¾ç½®   é¢œè‰²åè½¬  256è‰²
  982          //-------------------------------------------------------------------------------------------------------
             -------------
  983          void oled_dis_bmp_spi(uint16 high, uint16 width, uint8 *p, uint8 value)
  984          {
  985   1        uint16 i, j;
  986   1        uint16 temp, temp1;
  987   1        uint8 dat;
  988   1      
  989   1        temp1 = high % 8;
  990   1        if (temp1 == 0)
  991   1          temp = high / 8;
  992   1        else
  993   1          temp = high / 8 + 1;
  994   1      
  995   1        for (i = 0; i < temp; i++)
  996   1        {
  997   2          oled_set_pos_spi((uint8)0, (uint8)i);
  998   2          for (j = 0; j < width; j++)
  999   2          {
 1000   3            dat = 0;
 1001   3            if (i < (temp - 1) || !temp1 || temp1 >= 1)
 1002   3              dat |= (*(p + i * 8 * width + j + width * 0) > value ? 1 : 0) << 0;
 1003   3            if (i < (temp - 1) || !temp1 || temp1 >= 2)
 1004   3              dat |= (*(p + i * 8 * width + j + width * 1) > value ? 1 : 0) << 1;
 1005   3            if (i < (temp - 1) || !temp1 || temp1 >= 3)
 1006   3              dat |= (*(p + i * 8 * width + j + width * 2) > value ? 1 : 0) << 2;
 1007   3            if (i < (temp - 1) || !temp1 || temp1 >= 4)
 1008   3              dat |= (*(p + i * 8 * width + j + width * 3) > value ? 1 : 0) << 3;
 1009   3            if (i < (temp - 1) || !temp1 || temp1 >= 5)
 1010   3              dat |= (*(p + i * 8 * width + j + width * 4) > value ? 1 : 0) << 4;
 1011   3            if (i < (temp - 1) || !temp1 || temp1 >= 6)
 1012   3              dat |= (*(p + i * 8 * width + j + width * 5) > value ? 1 : 0) << 5;
 1013   3            if (i < (temp - 1) || !temp1 || temp1 >= 7)
 1014   3              dat |= (*(p + i * 8 * width + j + width * 6) > value ? 1 : 0) << 6;
 1015   3            if (i < (temp - 1) || !temp1 || temp1 >= 8)
 1016   3              dat |= (*(p + i * 8 * width + j + width * 7) > value ? 1 : 0) << 7;
 1017   3      
 1018   3            oled_wrdat_spi(dat);
 1019   3          }
 1020   2        }
 1021   1      }
 1022          
 1023          //-------------------------------------------------------------------------------------------------------
             -------------
 1024          //  @brief      æ±‰å­—æ˜¾ç¤º
 1025          //  @param      x       æ¨ªåæ ‡ 0-127
 1026          //  @param      y       çºµåæ ‡ 0-7
 1027          //  @param      size    å–æ¨¡çš„æ—¶å€™è®¾ç½®çš„æ±‰å­—å­—ä½“å¤§å°ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªæ±‰å­—å ç”¨çš„ç‚¹é˜µ
             -é•¿å®½ä¸ºå¤šå°‘ä¸ªç‚¹ï¼Œå–æ¨¡çš„æ—¶å€™éœ€è¦é•¿å®½æ˜¯ä¸€æ ·çš„ã€‚
C251 COMPILER V5.60.0,  SEEKFREE_OLED                                                      14/06/24  16:35:49  PAGE 18  

 1028          //  @param      *p      éœ€è¦æ˜¾ç¤ºçš„æ±‰å­—æ•°ç»„
 1029          //  @param      len     éœ€è¦æ˜¾ç¤ºå¤šå°‘ä½
 1030          //  @return     void
 1031          //  @since      v1.0
 1032          //  Sample usage:
 1033          //  @Note       ä½¿ç”¨PCtoLCD2002è½¯ä»¶å–æ¨¡       é˜´ç ã€é€è¡Œå¼ã€é¡ºå‘   16*16
 1034          //-------------------------------------------------------------------------------------------------------
             -------------
 1035          void oled_print_chinese_spi(uint8 x, uint8 y, uint8 size, const uint8 *p, uint8 len)
 1036          {
 1037   1        uint16 i, j, k;
 1038   1      
 1039   1        for (i = 0; i < len; i++)
 1040   1        {
 1041   2          for (j = 0; j < (size / 8); j++)
 1042   2          {
 1043   3            oled_set_pos_spi((uint8)(x + i * size), (uint8)(y + j));
 1044   3            for (k = 0; k < 16; k++)
 1045   3            {
 1046   4              oled_wrdat_spi(*p);
 1047   4              p++;
 1048   4            }
 1049   3          }
 1050   2        }
 1051   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =      4598     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =    ------        258
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =        10     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
